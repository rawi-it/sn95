<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>اختبر نفسك في أرقام اليوم الوطني</title>
  <style>
    :root{
      --bg:#003439; --gold:#886C35; --white:#fff;
      --row-top:80px; --row-mid:500px; --row-bot:80px;
      --logo-h:70px; --gold-h:480px; --gold-w:90%;
      --ink:#ffffff; --accent:#ffffff;
      --option-bg:rgba(255,255,255,.12); --option-bg-hover:rgba(255,255,255,.2);
    }
    html,body{height:100%;margin:0}
    body{
      background:url("images/ptrn.png") repeat;
      display:flex;justify-content:center;align-items:center;
      font-family:Tahoma,Arial,sans-serif;color:var(--white);
    }
    .canvas{width:1080px;height:calc(var(--row-top)+var(--row-mid)+var(--row-bot));background:var(--bg);box-sizing:border-box;}
    table.grid{width:100%;height:100%;border-collapse:collapse;table-layout:fixed;}
    table.grid[role="presentation"] td{border:none;padding:8px;text-align:center;vertical-align:middle;box-sizing:border-box;}
    .row-1{height:var(--row-top)} .row-2{height:var(--row-mid)} .row-3{height:var(--row-bot)}
    .logo{height:var(--logo-h);max-width:100%}
    .cell-1{text-align:right;vertical-align:top} .cell-3{text-align:left;vertical-align:top}
    .cell-7{text-align:right;vertical-align:bottom;padding-right:10px}
    .cell-8{text-align:center;vertical-align:bottom}
    .cell-9{text-align:left;vertical-align:bottom;padding-left:10px}
    .signature{font-weight:700;font-size:18px;white-space:nowrap}

    .gold-box{
      background:var(--gold);border:3px solid var(--white);border-radius:10px;
      width:var(--gold-w);height:var(--gold-h);margin:auto;box-sizing:border-box;
      display:flex;align-items:center;justify-content:center;color:var(--ink);padding:18px;
    }

    .gold-content{
      width:100%;height:100%;
      display:flex;flex-direction:column;justify-content:center;align-items:center;gap:14px;text-align:center;
    }
    .title{font-weight:800;font-size:clamp(22px,6.2vh,38px);line-height:1.2}
    .input{
      width:min(520px,90%);height:54px;border:none;border-radius:10px;
      text-align:center;font-size:clamp(18px,4.5vh,26px);
    }
    .btn{
      cursor:pointer;border:2px solid var(--accent); color:var(--ink);
      background:transparent;border-radius:12px;padding:10px 22px;
      font-weight:800;font-size:clamp(18px,4.2vh,24px);
    }
    .btn:disabled{opacity:.45;cursor:not-allowed}

    .options{width:100%;max-width:760px;display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .option{
      background:var(--option-bg);border:2px solid #fff;border-radius:12px;
      padding:14px 10px;cursor:pointer;user-select:none;
      font-size:clamp(18px,4.2vh,26px);font-weight:700;
    }
    .option:hover{background:var(--option-bg-hover)}
    .option.selected{outline:3px solid #fff}

    .nav{width:100%;max-width:760px;display:flex;align-items:center;gap:12px;margin-top:6px}
    .progress{flex:1;height:10px;border:2px solid var(--white);border-radius:999px;overflow:hidden;background:rgba(255,255,255,.18)}
    .bar{height:100%;width:0;background:var(--accent);transition:width .25s ease}

    .score{font-size:clamp(20px,5vh,34px);font-weight:900;line-height:1.4}
    .desc{font-size:clamp(16px,3.6vh,22px)}
    .share-row{display:flex;gap:8px;justify-content:center;flex-wrap:wrap}
    .hr{width:100%;max-width:760px;border:0;border-top:2px solid rgba(255,255,255,.6);margin:6px 0 4px}
  </style>
</head>
<body>
  <div class="canvas">
    <table class="grid" role="presentation" aria-label="لوحة اختبار أبعاد 3×3">
      <tr class="row-1">
        <td class="cell-1"><img class="logo" src="images/nd95logo.png" alt="nd95logo"></td>
        <td></td>
        <td class="cell-3"><img class="logo" src="images/moelogo.png" alt="moelogo"></td>
      </tr>
      <tr class="row-2">
        <td colspan="3">
          <div class="gold-box">
            <div class="gold-content" id="app"><!-- يُحقن هنا --></div>
          </div>
        </td>
      </tr>
      <tr class="row-3">
        <td class="cell-7"><div class="signature">By:Rawiah itMKH</div></td>
        <td class="cell-8"><img class="logo" src="images/itlogo.png" alt="itlogo"></td>
        <td class="cell-9"><span class="counter" id="visitorCount">عدد الزوار: —</span></td>
      </tr>
    </table>
  </div>

  <script>
    (function(){
      const app = document.getElementById('app');
      const pageURL = 'http://bit.ly/sn95';

      const baseQuestions = [
        { text:'عدد الأيام الوطنية في عهد الملك عبدالعزيز', answer:21, distractors:[17,19,23] },
        { text:'عدد الأيام الوطنية في عهد الملك سعود',    answer:11, distractors:[9,12,13]      },
        { text:'عدد الأيام الوطنية في عهد الملك فيصل',    answer:11, distractors:[8,10,14]      },
        { text:'عدد الأيام الوطنية في عهد الملك خالد', answer:7, distractors:[6,8,9] },
        { text:'عدد الأيام الوطنية في عهد الملك فهد', answer:23, distractors:[20,21,22] },
        { text:'عدد الأيام الوطنية في عهد الملك عبدالله', answer:10, distractors:[8,9,11] },
        { text:'عدد الأيام الوطنية في عهد الملك سلمان حتى اليوم', answer:11, distractors:[9,10,12] },
        { text:'في عهد الملك فيصل صدر مرسوم ملكي بجعل 23 سبتمبر يومًا وطنيًا يُحتفل به، بدءا من اليوم الوطني رقم', answer:35, distractors:[30,33,37] },
        { text:'أقرّ الملك عبدالله، أن يكون اليوم الوطني إجازة رسمية ابتداءً من اليوم الوطني رقم', answer:75, distractors:[70,72,78] },
        { text:'دشنت أمانة جدة أطول سارية علم في العالم في اليوم الوطني رقم', answer:84, distractors:[80,82,86] },
        { text:'صادف اليوم الوطني يوم عرفة لأول مرة في اليوم الوطني رقم', answer:85, distractors:[82,83,87] },
        { text:'اليوم الوطني السعودي يوافق ____ من الميزان', answer:'الأول', distractors:['الثاني','الثالث','الرابع'] },
      ];

      let userName = '';
      let questions = [];
      let index = 0;
      let picks = [];

      const shuffle = (arr)=> arr.map(a=>[Math.random(),a]).sort((a,b)=>a[0]-b[0]).map(a=>a[1]);

      function initQuiz(){
        questions = shuffle(baseQuestions).map(q=>({ ...q, options: shuffle([q.answer, ...q.distractors]) }));
        index = 0; picks = new Array(questions.length).fill(null);
      }

      function renderWelcome(){
        app.innerHTML = `
          <div class="title">اختبر نفسك في أرقام اليوم الوطني</div>
          <input id="nameInput" class="input" type="text" placeholder="اسمك هنا" />
          <button id="startBtn" class="btn">ابدأ الاختبار</button>
        `;
        const nameInput = document.getElementById('nameInput');
        const startBtn  = document.getElementById('startBtn');
        startBtn.onclick = ()=>{
          userName = (nameInput.value||'').trim();
          if(!userName){ nameInput.focus(); return; }
          initQuiz(); renderQuestion(); updateProgress();
        };
        nameInput.addEventListener('keydown', e=>{ if(e.key==='Enter') startBtn.click(); });
      }

      function renderQuestion(){
        const q = questions[index];
        app.innerHTML = `
          <div class="title">${q.text}</div>
          <div class="options" id="opts"></div>
          <div class="nav">
            <button id="prev" class="btn">السابق</button>
            <div class="progress"><div class="bar" id="bar"></div></div>
            <button id="next" class="btn" disabled>التالي</button>
          </div>
        `;

        const prevBtn = document.getElementById('prev');
        const nextBtn = document.getElementById('next');
        const optsBox = document.getElementById('opts');

        // الخيارات
        q.options.forEach(val=>{
          const o = document.createElement('div');
          o.className = 'option';
          o.textContent = val;
          o.onclick = ()=>{
            picks[index] = val;
            Array.from(optsBox.children).forEach(c=>c.classList.remove('selected'));
            o.classList.add('selected');
            nextBtn.disabled = false;
          };
          optsBox.appendChild(o);
        });

        // إعادة تحديد سابق إن وجد
        if(picks[index] !== null){
          nextBtn.disabled = false;
          const at = Array.from(optsBox.children).find(c=> +c.textContent === picks[index]);
          if(at) at.classList.add('selected');
        }

        // "إنهاء" في آخر سؤال
        if(index === questions.length - 1) nextBtn.textContent = 'إنهاء';

        prevBtn.disabled = (index===0);
        prevBtn.onclick = ()=>{ if(index>0){ index--; renderQuestion(); updateProgress(); } };

        nextBtn.onclick = ()=>{
          if(picks[index] === null) return;
          if(index < questions.length - 1){
            index++; renderQuestion(); updateProgress();
          } else {
            updateProgress(true);
            renderResult();
          }
        };

        updateProgress();
      }

      function updateProgress(forceDone=false){
        const bar = document.getElementById('bar');
        if(!bar) return;
        const total = questions.length;
        const pct = forceDone ? 100 : (total<=1 ? 100 : Math.round( index * 100 / (total-1) ));
        bar.style.width = pct + '%';
      }

      function renderResult(){
        const score = picks.reduce((acc, v, i)=> acc + (v===questions[i].answer ? 1 : 0), 0);
        const percent = Math.round((score / questions.length) * 100);

        let desc = '';
        if(percent >= 90){
          desc = '🎉 رائع! وطنيتك ومعرفتك بالتاريخ بالأرقام مشرفة 👏';
        }else if(percent >= 60){
          desc = '📚 جيد جدًا! معلوماتك الوطنية قوية، زدها بالاطلاع أكثر 🤝';
        }else if(percent >= 30){
          desc = '🔍 متوسط… تحتاج تقرأ وتتعرف أكثر على أرقام الوطن 🇸🇦';
        }else{
          desc = '⚠️ راجع نفسك! وطنك يستحق أن تعرف تاريخه ومنجزاته بالأرقام 💚';
        }

        const shareMsg =
`أنا ${userName || 'المستخدم'} حققت ${percent}% 
في اختبار أرقام اليوم الوطني 

جاهز تتحداني؟ 
جرّب بنفسك وشاركني نتيجتك:
${pageURL}`;

        const wa = `https://wa.me/?text=${encodeURIComponent(shareMsg)}`;
        const tg = `https://t.me/share/url?url=${encodeURIComponent(pageURL)}&text=${encodeURIComponent(shareMsg)}`;

        app.innerHTML = `
          <div class="title">النتيجة</div>
          <div class="score">${userName || 'المستخدم'}<br>حققت: ${percent}%</div>
          <div class="desc">${desc}</div>

          <div class="share-row" style="margin-top:8px;">
            <button id="again" class="btn">إعادة الاختبار</button>
          </div>

          <hr class="hr">

          <div class="desc">شارك نتيجتك وتحدّى أصدقائك… من يعرف أرقام الوطن أكثر؟</div>
          <div class="share-row" style="margin-top:8px;">
            <a class="btn" href="${wa}" target="_blank" rel="noopener">واتساب</a>
            <a class="btn" href="${tg}" target="_blank" rel="noopener">تليجرام</a>
          </div>
        `;
        document.getElementById('again').onclick = renderWelcome;
      }

      renderWelcome();
    })();
  </script>

  <script>
    (function(){
      const el = document.getElementById('visitorCount');
      const WORKER_URL = 'https://sn95-visitor.alharbi-rawiah.workers.dev/';
      const setText = v => el.textContent = 'عدد الزوار: ' + v;

      fetch(WORKER_URL, {cache:'no-store', mode:'cors', referrerPolicy:'no-referrer'})
        .then(r => { if(!r.ok) throw new Error('HTTP '+r.status); return r.json(); })
        .then(d => setText(d.value))
        .catch(() => setText('—'));
    })();
  </script>
</body>
</html>
