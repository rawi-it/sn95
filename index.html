<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="format-detection" content="telephone=no">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>اختبر نفسك في أرقاام اليوم الوطني</title>
  <style>
    :root{ --bg:#003439; --gold:#886C35; --white:#fff; }

    body{
      margin:0; padding:0; background:var(--bg);
      display:flex; justify-content:center; align-items:center;
      min-height:100vh;
      font-family:"Tahoma",sans-serif; color:#fff;
    }

    table{
      border-collapse:collapse;
      width:95%; max-width:1000px;
      height:95%;
      table-layout:fixed;
    }

    /* لا حدود للجدول */
    td{
      text-align:center; vertical-align:middle;
      width:33.33%;
      border:none;
    }

    img{
      height:70px; max-width:100%;
    }

    .gold-box{
      background:var(--gold);
      border:3px solid var(--white);
      border-radius:12px;
      color:#fff;
      padding:20px;
      box-sizing:border-box;
      width:95%;
      max-width:720px;
      margin:auto;
    }

    .page-title{
      font-size:22px;
      font-weight:bold;
      text-align:center;
      margin:0 0 15px;
    }

    .form-row{
      display:flex; gap:10px; align-items:center; justify-content:center; flex-wrap:wrap;
    }

    .input{
      background:rgba(0,0,0,.15);
      border:2px solid var(--white);
      border-radius:10px;
      color:#fff;
      padding:12px 16px;
      font-size:16px;
      outline:none;
      min-width:240px;
    }

    .btn{
      border:none;
      border-radius:12px;
      padding:12px 18px;
      font-size:16px;
      cursor:pointer;
      color:#003439;
      background:#fff;
      font-weight:bold;
      min-width:120px;
    }
    .btn[disabled]{ opacity:.5; cursor:not-allowed; }
    .btn-ghost{ background:transparent; color:#fff; border:2px solid #fff; }

    .q-text{ font-size:18px; font-weight:bold; margin:8px 0 14px; text-align:center; }
    .options{ display:grid; gap:12px; grid-template-columns:repeat(auto-fit,minmax(140px,1fr)); }

    .opt{
      background:rgba(0,0,0,.15);
      border:2px solid #fff;
      border-radius:12px;
      padding:12px;
      text-align:center;
      cursor:pointer;
      user-select:none;
      font-size:16px;
    }
    .opt.selected{ outline:3px solid #fff; background:rgba(0,0,0,.25); }

    .nav{
      display:flex; justify-content:space-between; align-items:center;
      gap:10px; margin-top:14px; flex-wrap:wrap;
    }
    .progress-bar{
      flex:1; height:6px; background:rgba(255,255,255,.3);
      border-radius:4px; margin:0 8px; position:relative;
    }
    .progress-fill{
      height:100%; background:#fff; border-radius:4px;
      width:0%; transition:width .25s ease;
    }

    .result{ text-align:center; line-height:1.8; font-size:18px; }
    .score{ font-size:28px; font-weight:bold; margin-top:6px; }
    .desc{ margin:10px 0; font-size:16px; }
    .share-buttons{ margin-top:16px; display:flex; justify-content:center; gap:10px; flex-wrap:wrap; }
    .share-buttons a{
      text-decoration:none; background:#fff; color:#003439;
      padding:10px 16px; border-radius:10px;
      font-size:15px; font-weight:bold;
    }

    .footer-text{
      font-size:14px; font-weight:bold; color:#fff;
      text-align:right; padding-right:10px; white-space:nowrap;
    }
    .counter{ font-size:14px; font-weight:bold; color:#fff !important; }
    .counter a{ color:#fff !important; text-decoration:none !important; }

    /* تحسين للجوال */
    @media (max-width:640px){
      table{ width:100%; height:auto; }
      img{ height:50px; }
      .page-title{ font-size:20px; }
      .q-text{ font-size:17px; }
      .input{ font-size:16px; min-width:200px; }
      .btn{ font-size:15px; padding:12px; min-width:100px; }
      .opt{ font-size:15px; padding:10px; }
      .score{ font-size:24px; }
    }
  </style>
</head>
<body>
  <table>
    <!-- الصف الأول -->
    <tr>
      <!-- الخلية 1: nd95logo فوق يمين -->
      <td style="text-align:right;"><img src="images/nd95logo.png" alt="nd95logo"></td>
      <td></td>
      <!-- الخلية 3: moelogo فوق يسار -->
      <td style="text-align:left;"><img src="images/moelogo.png" alt="moelogo"></td>
    </tr>

    <!-- الصف الثاني (مدمج: المربع الذهبي) -->
    <tr>
      <td colspan="3">
        <div class="gold-box" id="app">
          <!-- واجهة 1: الاسم + ابدأ -->
          <div id="view-start">
            <h1 class="page-title">اختبر نفسك في أرقام اليوم الوطني</h1>
            <div class="form-row">
              <input id="username" class="input" type="text" placeholder="اكتب اسمك هنا" aria-label="اسم المستخدم">
              <button class="btn" id="btnStart">ابدأ الاختبار</button>
            </div>
          </div>

          <!-- واجهة 2: الأسئلة -->
          <div id="view-quiz" style="display:none;">
            <div class="q-text" id="qText"></div>
            <div class="options" id="options"></div>
            <div class="nav">
              <button class="btn btn-ghost" id="btnPrev">السابق</button>
              <div class="progress-bar"><div class="progress-fill" id="progress"></div></div>
              <button class="btn" id="btnNext">التالي</button>
            </div>
          </div>

          <!-- واجهة 3: النتيجة -->
          <div id="view-result" style="display:none;">
            <h2 class="page-title">النتيجة</h2>
            <div class="result">
              <div id="rName"></div>
              <div>حققت:</div>
              <div class="score" id="rScore">0%</div>
              <div class="desc" id="rDesc"></div>
              <div class="subtext">شارك نتيجتك وتحدى أصدقائك… من يعرف أرقام الوطن أكثر؟</div>
              <div class="share-buttons">
                <a id="shareWA" target="_blank">شارك على واتساب</a>
                <a id="shareTG" target="_blank">شارك على تليجرام</a>
              </div>
              <div style="margin-top:12px;">
                <button class="btn btn-ghost" id="btnRetry">إعادة المحاولة</button>
              </div>
            </div>
          </div>
        </div>
      </td>
    </tr>

    <!-- الصف الثالث -->
    <tr>
      <!-- الخلية 7: نص التوقيع أسفل يمين -->
      <td class="footer-text">By:Rawiah itMKH</td>
      <!-- الخلية 8: itlogo أسفل وسط -->
      <td><img src="images/itlogo.png" alt="itlogo"></td>
      <!-- الخلية 9: عدّاد الزوار -->
      <td><span class="counter" id="visitorCount">👥 عدد الزوار: —</span></td>
    </tr>
  </table>

  <script>
    /* ========================= منطق الاختبار ========================= */
    const vStart=document.getElementById('view-start');
    const vQuiz=document.getElementById('view-quiz');
    const vResult=document.getElementById('view-result');

    const usernameInput=document.getElementById('username');
    const btnStart=document.getElementById('btnStart');
    const btnPrev=document.getElementById('btnPrev');
    const btnNext=document.getElementById('btnNext');

    const qText=document.getElementById('qText');
    const optionsWrap=document.getElementById('options');
    const progress=document.getElementById('progress');

    const rName=document.getElementById('rName');
    const rScore=document.getElementById('rScore');
    const rDesc=document.getElementById('rDesc');
    const btnRetry=document.getElementById('btnRetry');

    const shareWA=document.getElementById('shareWA');
    const shareTG=document.getElementById('shareTG');

    const baseQuestions=[
      { text:"عدد الأيام الوطنية في عهد الملك عبدالعزيز", correct:21, distractors:[17,19,23] },
      { text:"عدد الأيام الوطنية في عهد الملك سعود", correct:11, distractors:[9,12,14] },
      { text:"عدد الأيام الوطنية في عهد الملك فيصل", correct:11, distractors:[8,10,13] }
    ];

    const urlShare = "https://rawi-it.github.io/sn95/"; // رابط صفحتك النهائي

    function shuffle(arr){ return arr.slice().sort(()=>Math.random()-0.5); }

    let questions=[],current=0,nameVal="",picks=[],score=0;

    function initQuiz(){
      const shuffledQs=shuffle(baseQuestions);
      questions=shuffledQs.map(q=>({
        text:q.text,
        correct:q.correct,
        options:shuffle([q.correct,...q.distractors])
      }));
      current=0; score=0; picks=new Array(questions.length).fill(null);
    }

    function show(view){
      vStart.style.display=(view==='start')?'block':'none';
      vQuiz.style.display=(view==='quiz')?'block':'none';
      vResult.style.display=(view==='result')?'block':'none';
    }

    function updateProgress(){
      const pct=(current/(questions.length-1))*100; // 0% أول سؤال، 100% آخر سؤال
      progress.style.width=pct+"%";
    }

    function renderQuestion(){
      const q=questions[current];
      qText.textContent=q.text;
      optionsWrap.innerHTML="";
      q.options.forEach(val=>{
        const opt=document.createElement('div');
        opt.className='opt'; opt.textContent=val;
        if(picks[current]===val) opt.classList.add('selected');
        opt.onclick=()=>{
          picks[current]=val;
          [...optionsWrap.children].forEach(c=>c.classList.remove('selected'));
          opt.classList.add('selected');
        };
        optionsWrap.appendChild(opt);
      });
      btnPrev.disabled=current===0;
      btnNext.textContent=(current===questions.length-1)?"إنهاء":"التالي";
      updateProgress();
    }

    function calcScore(){
      let s=0; for(let i=0;i<questions.length;i++){ if(picks[i]===questions[i].correct) s++; }
      return s;
    }

    btnStart.onclick=()=>{
      nameVal=usernameInput.value.trim();
      if(!nameVal){ alert("فضلاً اكتب اسمك أولاً"); return; }
      initQuiz(); show('quiz'); renderQuestion();
    };

    btnPrev.onclick=()=>{ if(current>0){ current--; renderQuestion(); } };

    btnNext.onclick=()=>{
      if(picks[current]===null){ alert("فضلاً اختر إجابة قبل الانتقال."); return; }
      if(current===questions.length-1){
        const s=calcScore();
        const pct=Math.round(s/questions.length*100);
        rName.textContent=nameVal;
        rScore.textContent=pct+"%";
        progress.style.width="100%";
        let desc="";
        if(pct>=90) desc="🎉 رائع! وطنيتك ومعرفتك بالتاريخ بالأرقام مشرفة 👏";
        else if(pct>=60) desc="📚 جيد جدًا! معلوماتك الوطنية قوية، زدها بالاطلاع أكثر 🤝";
        else if(pct>=30) desc="🔍 متوسط… تحتاج تقرأ وتتعرف أكثر على أرقام الوطن 🇸🇦";
        else desc="⚠️ راجع نفسك! وطنك يستحق أن تعرف تاريخه ومنجزاته بالأرقام 💚";
        rDesc.textContent=desc;

        // مشاركة
        const msg=`أنا ${nameVal} حققت ${pct}% 🎉\nفي اختبار أرقام اليوم الوطني 🇸🇦\nجاهز تتحداني؟ 👇\n${urlShare}`;
        shareWA.href=`https://wa.me/?text=${encodeURIComponent(msg)}`;
        shareTG.href=`https://t.me/share/url?url=${encodeURIComponent(urlShare)}&text=${encodeURIComponent(msg)}`;

        show('result');
        return;
      }
      current++; renderQuestion();
    };

    btnRetry.onclick=()=>{ initQuiz(); usernameInput.value=""; show('start'); };

    show('start');

    /* ========================= عدّاد الزوار =========================
       نحاول get → إنشاء عند الحاجة → hit → تحديث نص العداد.
       مع بديل محلي localStorage إذا كانت الخدمة محجوبة.
    */
    (function visitorCounter(){
      const el = document.getElementById("visitorCount");
      const NS="rawi-it-sn95", KEY="visits";
      const EP="https://api.countapi.xyz";

      const setText = v => { el.innerHTML = "👥&nbsp;عدد الزوار: " + v; };

      function localFallback() {
        try{
          let v = parseInt(localStorage.getItem("local_visits") || "0", 10);
          v++;
          localStorage.setItem("local_visits", v);
          setText(v + " (محلي)");
        }catch{ setText("—"); }
      }

      // إنشاء عند الحاجة ثم hit
      fetch(`${EP}/get/${NS}/${KEY}`)
        .then(r=> r.ok ? r.json()
                       : fetch(`${EP}/create?namespace=${encodeURIComponent(NS)}&key=${encodeURIComponent(KEY)}&value=0`).then(x=>x.json()))
        .then(()=> fetch(`${EP}/hit/${NS}/${KEY}`)).then(r=>r.json())
        .then(d=> setText(d.value))
        .catch(()=> localFallback());

      // تحديث خفيف كل 30 ثانية (اختياري لتحسين الإحساس بالتحديث)
      setInterval(()=>{
        fetch(`${EP}/get/${NS}/${KEY}`).then(r=>r.json()).then(d=> setText(d.value)).catch(()=>{});
      }, 30000);
    })();
  </script>
</body>
</html>
